version: 2

build:
  os: ubuntu-22.04
  tools:
    python: mambaforge-4.10
  jobs:
    post_checkout:
    # Download and uncompress the binary
    # https://git-lfs.github.com/
    - wget https://github.com/git-lfs/git-lfs/releases/download/v3.1.4/git-lfs-linux-amd64-v3.1.4.tar.gz
    - tar xvfz git-lfs-linux-amd64-v3.1.4.tar.gz
    # Modify LFS config paths to point where git-lfs binary was downloaded
    - git config filter.lfs.process "`pwd`/git-lfs filter-process"
    - git config filter.lfs.smudge  "`pwd`/git-lfs smudge -- %f"
    - git config filter.lfs.clean "`pwd`/git-lfs clean -- %f"
    # Make LFS available in current repository
    - ./git-lfs install
    # Download content from remote
    - ./git-lfs fetch
    # Make local files to have the real content on them
    - ./git-lfs checkout
    post_create_environment:
    # install cherab-phix using dev.py CLI
    - python dev.py build
    - python dev.py install
    # install atomic data from openadas repository
    - python -c "from cherab.openadas.repository import populate; populate()"

conda:
  environment: environment.yaml

# Build documentation in the docs/ directory with Sphinx
sphinx:
  configuration: docs/conf.py
  builder: html
  fail_on_warning: false
